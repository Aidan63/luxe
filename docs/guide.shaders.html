<!DOCTYPE html>
<html>
    
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <link rel="shortcut icon" href="./images/favicon.png" />

        <link rel="stylesheet" type="text/css" href="./css/style.css" media="all">
        <link rel="stylesheet" type="text/css" href="./css/code.css" media="all">
        <link rel="stylesheet" type="text/css" href="./css/font.css" media="all">
        
        <link rel="stylesheet" type="text/css" href="./css/tooltipster.css" media="all">
        <link rel="stylesheet" type="text/css" href="./css/tooltipster-shadow.css" media="all">
        
        <script src="./js/jquery-2.0.3.min.js"> </script>
        <script src="./js/jquery.tooltipster.min.js"> </script>

        <script>

            $(document).ready(function() {

                $('.section').css('display','none');
                $('.readmore').click(function(e){
                    var _child = $(this).parent().find('.section').first();
                    var _opp = 'block';
                    if( _child.css('display') == 'block' ) {
                        _opp = 'none';
                    } else {
                    }
                    _child.css('display', _opp);
                });

                $('div.sample').on('click', function(e){
                        //get the data tag
                    var content = $(this).attr('data-content');
                        //remove clicking handler
                    $(this).off('click');
                        //replace the content!
                    $(this).html('<iframe src="'+content+'" sandbox="allow-same-origin allow-scripts" style="overflow:hidden; scrollbar:none; border: 0; width:645px; height:450px;"></iframe> ')
                });

                $('.tooltip').tooltipster({
                    theme:'tooltipster-shadow'
                });

            }); //document.ready

        </script>
    </head>

    <body>
        <div class="content">
            <p><a href="index.html"><img src="http://luxeengine.com/images/logo.png" alt="Logo"></a></p>
<h3 id="-back-to-feature-guide-guide-html-shaders-"><a href="guide.html#shaders">Back to feature guide</a></h3>
<h3 id="-view-all-guides-guide-html-"><a href="guide.html">View all guides</a></h3>
<p><a href="#usage">jump to luxe shader usage?</a></p>
<h2 id="shaders-in-luxe">Shaders in luxe</h2>
<hr>
<p>Mouse x axis controls the distortion in the distort shader.<br>Mouse x axis controls the hue degrees in the Hue change shader.<br>Level background has a severe tilt shift shader that also desaturates the image.   </p>
<div data-content="samples/test_shaders/index.html" class="sample"> <p>Click to run example</p> </div>

<hr>
<h2 id="wait-what-are-shaders-exactly-">Wait, what are shaders exactly?</h2>
<hr>
<p>When you draw something on screen, it is generally submitted as some geometry.  </p>
<p>That is, a set of vertices describing the geometry, is sent to the graphics card for rendering. A sprite, is a “quad”, and generally is sent as two triangles.</p>
<p>When you send geometry to the graphics card to be drawn, you can specify custom shaders to use that will be applied to the geometry.   </p>
<p>There are two kinds of shaders to understand for now - don’t worry, they always seem more complex than they are but in practice they are quite logical.</p>
<h2 id="the-vertex-shader">The vertex shader</h2>
<hr>
<p>As mentioned, there are vertices sent to draw a sprite. Two triangles, usually, and a triangle has 3 vertices. 
That means, for a quad or rectangle like a sprite, there are 6 vertices sent to the graphics card.</p>
<p>When these 6 vertices reach the rendering pipeline, there is a small program (a shader) that runs on each and every vertex.   </p>
<p>That program only cares about one thing really : the final position that the vertex will end up. Let’s visualise this below :</p>
<p><img src="images/vertex_shader.png" alt="vertex shader"></p>
<h2 id="the-fragment-shader">The fragment shader</h2>
<hr>
<p>After that, it sends the shader to be “rasterized”, that means converted into pixels so it can be drawn on the screen. </p>
<p>When doing this, the rasterized geometry, i.e the pixels, are then given to the “fragment” shader. These are also commonly referred to as pixel shaders, because they apply to the rasterized pixels (fragments!) that are being submitted to the screen drawing buffer.</p>
<p>The fragment shader, much like the vertex shader, is run on every single fragment. Again, it is good at doing this really quickly, but this is important to understand that a single line of code in a shader can cause drastic performance hits due to the sheer number of times the code will be run! See the note at the end of this section for some interesting numbers.</p>
<p>The fragment shader only cares about what the resulting color of the fragment becomes. It will also interpolate (blend) from each vertex, based on it’s location between them. Let’s visualize this below :</p>
<p><img src="images/fragment_shader.png" alt="fragment shader"></p>
<p><strong>note on numbers</strong><br>A game renderered at 1080p, a resolution of 1920x1080 pixels, would be 1920 x 1080 = 2,073,600 pixels. That is per frame - usually games run at 30 or 60 frames per second. That means (1920 x 1080) x 60 for one second of time, that’s a total of 124,416,000 pixels, per second. For a <em>single</em> frame buffer, usually games have multiple buffers as well.</p>
<h2 id="endless-possibilities">Endless possibilities</h2>
<hr>
<p>Because of the nature of shaders being so versatile, there are many many things that you can do with them. From complex 3D lighting algorithms down to simple image distortion or coloring (like in the live demo), you can do a huge range of things with the rendering pipeline.</p>
<hr>
<p>&nbsp;
<a name="usage" href="#usage"></p>
<h2 id="using-shaders-in-luxe-a-">Using shaders in luxe </a></h2>
<hr>
<p>luxe makes using shaders a bit easier by wrapping up the details and giving you the ability to load and apply shaders to your sprites and geometry easily. It also makes it easy to send information into the shaders, because that is important to make great custom shaders. These values for a pixel shader are called “uniforms”, and are set from the shader object you create.</p>
<p>Take a look at the code from the demo, and you should be able to follow along as to what is happening.</p>
<pre><code>    <span class="hljs-comment">//we create a variable to hold the shader</span>
<span class="hljs-keyword">var</span> hue_shader : Shader;

    <span class="hljs-comment">//and then we load the shader code, and we leave the vertex parameter blank, to use the default shader!</span>
hue_shader = Luxe.loadShader(<span class="hljs-string">'assets/huechange.glsl'</span>);

    <span class="hljs-comment">//then we tell the sprite to use this shader when rendering</span>
hue_sprite.shader = hue_shader;
</code></pre><p>And finally, when we move the mouse, we send some information to the shader to change the color</p>
<pre><code><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onmousemove</span><span class="hljs-params">( e:MouseEvent )</span> </span>{

    <span class="hljs-keyword">var</span> percent = e.pos.x / Luxe.screen.w;
    <span class="hljs-keyword">var</span> hue = (Math.PI*<span class="hljs-number">2</span>) * percent;

        <span class="hljs-comment">//hue based on mouse x </span>
    hue_shader.set_uniform_float(<span class="hljs-string">'in_hue'</span>, hue);

}
</code></pre><h2 id="code-from-the-live-demo">Code from the live demo</h2>
<hr>
<h4 id="distort-glsl">distort.glsl</h4>
<pre><code>uniform sampler2D tex0;
uniform sampler2D tex1;

varying vec2 tcoord;
varying vec4 color;

uniform float distortamount;

void main() {

    vec4 direction = texture2D(tex1, tcoord);
    vec4 c = texture2D(tex0, tcoord + distortamount * (direction.rg - vec2(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>)));

    gl_FragColor = c;

}
</code></pre><h4 id="full-code-from-sample">full code from sample</h4>
<pre><code><span class="hljs-keyword">import</span> luxe.Input;
<span class="hljs-keyword">import</span> luxe.Sprite;
<span class="hljs-keyword">import</span> luxe.Vector;
<span class="hljs-keyword">import</span> luxe.Color;
<span class="hljs-keyword">import</span> phoenix.Shader;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">luxe</span>.<span class="hljs-title">Game</span> </span>{

    <span class="hljs-keyword">var</span> distort_sprite : Sprite;
    <span class="hljs-keyword">var</span> hue_sprite : Sprite;
    <span class="hljs-keyword">var</span> level_sprite : Sprite;

    <span class="hljs-keyword">var</span> level_tiltshift : Shader;
    <span class="hljs-keyword">var</span> hue_shader : Shader;
    <span class="hljs-keyword">var</span> distort_shader : Shader;

    <span class="hljs-keyword">var</span> loaded : Bool = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">var</span> loaded_logo : Bool = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ready</span><span class="hljs-params">()</span> </span>{

        <span class="hljs-keyword">var</span> luxe_tex = Luxe.loadTexture(<span class="hljs-string">'assets/luxe.png'</span>);

        <span class="hljs-keyword">var</span> level_texture = Luxe.loadTexture(<span class="hljs-string">'assets/level.png'</span>);
            level_texture.filter = phoenix.Texture.FilterType.nearest;

        <span class="hljs-keyword">var</span> distort_map = Luxe.loadTexture(<span class="hljs-string">'assets/distort.png'</span>);


        <span class="hljs-keyword">var</span> _size = Luxe.screen.h * <span class="hljs-number">0.8</span>;
        <span class="hljs-keyword">if</span>(_size &gt; <span class="hljs-number">512</span>) _size = <span class="hljs-number">512</span>;

        distort_sprite = <span class="hljs-keyword">new</span> Sprite({
            texture : luxe_tex,
            pos : <span class="hljs-keyword">new</span> Vector(_size/<span class="hljs-number">2</span>,_size),
            size : <span class="hljs-keyword">new</span> Vector(_size,_size)
        });        

        hue_sprite = <span class="hljs-keyword">new</span> Sprite({
            texture : luxe_tex,
            pos : <span class="hljs-keyword">new</span> Vector(_size+(_size*<span class="hljs-number">0.05</span>),_size),
            size : <span class="hljs-keyword">new</span> Vector(_size,_size)
        });

        level_sprite = <span class="hljs-keyword">new</span> Sprite({
            texture : level_texture,
            pos : <span class="hljs-keyword">new</span> Vector(Luxe.screen.w/<span class="hljs-number">2</span>,Luxe.screen.h/<span class="hljs-number">2</span>)
        });

            <span class="hljs-comment">//for the logo blocks image</span>
        luxe_tex.onload = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(tt)</span> </span>{

            distort_sprite.scale = <span class="hljs-keyword">new</span> Vector(<span class="hljs-number">0.5</span>,<span class="hljs-number">0.5</span>);
            hue_sprite.scale = <span class="hljs-keyword">new</span> Vector(<span class="hljs-number">0.5</span>,<span class="hljs-number">0.5</span>);

            hue_shader = Luxe.loadShader(<span class="hljs-string">'assets/huechange.glsl'</span>);
            hue_sprite.shader = hue_shader;

            loaded_logo = <span class="hljs-literal">true</span>;
        } <span class="hljs-comment">//luxe_tex on load</span>

        level_texture.onload = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(tt)</span> </span>{
            level_sprite.scale = <span class="hljs-keyword">new</span> Vector(Luxe.screen.w/<span class="hljs-number">240</span>,Luxe.screen.h/<span class="hljs-number">160</span>);
            <span class="hljs-comment">// #if !mobile</span>
              level_tiltshift = Luxe.loadShader(<span class="hljs-string">'assets/gray_tilt_shift.glsl'</span>);
              level_sprite.shader = level_tiltshift;
            <span class="hljs-comment">// #end</span>
        } <span class="hljs-comment">//level tex on load</span>

        distort_map.onload = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(tt)</span> </span>{

            distort_shader = Luxe.loadShader(<span class="hljs-string">'assets/distort.glsl'</span>);
            distort_sprite.shader = distort_shader;

                <span class="hljs-comment">//move to second slot</span>
            distort_map.slot = <span class="hljs-number">1</span>;
                <span class="hljs-comment">//set the uniform</span>
            distort_shader.set_uniform_texture(<span class="hljs-string">'tex1'</span>, distort_map);

            loaded = <span class="hljs-literal">true</span>;

        }    


    } <span class="hljs-comment">//ready</span>

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ontouchmove</span><span class="hljs-params">( e:TouchEvent )</span> </span>{
        <span class="hljs-keyword">if</span>(loaded &amp;&amp; loaded_logo) {

            <span class="hljs-keyword">var</span> percent = e.x / Luxe.screen.w;
            <span class="hljs-keyword">var</span> hue = (Math.PI*<span class="hljs-number">2</span>) * percent;

                <span class="hljs-comment">//distort based on mouse x</span>
            distort_shader.set_uniform_float(<span class="hljs-string">'distortamount'</span>, percent);
                <span class="hljs-comment">//hue based on mouse x </span>
            hue_shader.set_uniform_float(<span class="hljs-string">'in_hue'</span>, hue);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onmousemove</span><span class="hljs-params">( e:MouseEvent )</span> </span>{

        <span class="hljs-keyword">if</span>(loaded &amp;&amp; loaded_logo) {

            <span class="hljs-keyword">var</span> percent = e.pos.x / Luxe.screen.w;
            <span class="hljs-keyword">var</span> hue = (Math.PI*<span class="hljs-number">2</span>) * percent;

                <span class="hljs-comment">//distort based on mouse x</span>
            distort_shader.set_uniform_float(<span class="hljs-string">'distortamount'</span>, percent);
                <span class="hljs-comment">//hue based on mouse x </span>
            hue_shader.set_uniform_float(<span class="hljs-string">'in_hue'</span>, hue);
        }

    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onkeyup</span><span class="hljs-params">( e:KeyEvent )</span> </span>{
        <span class="hljs-keyword">if</span>(e.key == KeyValue.escape) {
            Luxe.shutdown();
        }        
    } <span class="hljs-comment">//onkeyup</span>


} <span class="hljs-comment">//Main</span>
</code></pre><p>&nbsp;   </p>
<h3 id="-back-to-feature-guide-guide-html-shaders-"><a href="guide.html#shaders">Back to feature guide</a></h3>
<h3 id="-view-all-guides-guide-html-"><a href="guide.html">View all guides</a></h3>
<p>&nbsp;<br>&nbsp;<br>&nbsp;   </p>

        </div>
    </body>

</html>